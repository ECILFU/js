<!doctype html>
<html lang="en">

<head>
<title>starfield</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<meta http-equiv="content-language" content="en">
<meta name="description" content="starfield">
<meta name="author" content="rez">
<meta name="version" content="3.0">
<meta name="copyright" content="rez 2007-2015">
<meta name="robots" content="all">
<style type="text/css">
body {margin:0px;padding:0px;overflow:hidden;user-select:none}
</style>
<script type="application/javascript">
/*-----------------------------------------------------------------------------.
|                 /\______  /\______  ____/\______     __                      |
|                 \____   \/  \__   \/  _ \____   \ __/  \____                 |
|                  / _/  _/    \/   /   /  / _/  _// / / / / /                 |
|                 /  \   \  /\ /   /\  /  /  \   \/ /\  / / /                  |
|                 \__/\   \/RTX______\___/\__/\   \/ / /_/_/                   |
|                      \___)   \__)            \___) \/                        |
|------------------------------------------------------------------------------|
|################################## STARFIELD #################################|
`-----------------------------------------------------------------------------*/

/*jslint white,this,maxlen:80*/
/*global window,jslint*/

Number.prototype.clamp=function(min,max)
  {
  'use strict';
  return Math.max(min,Math.min(this,max));
  };

var lol={}

lol.pr={w:3,h:3};     /* pixel ratio */
lol.zr=256;           /* perspective */
lol.timer=0;
lol.spd=1.0;          /* speed */
lol.rid=false;        /* frame request id */
lol.cvs=false;        /* canvas */
lol.ctx=false;        /* 2d context */

lol.util=
  {
  isboolean:function(v){if(typeof v==='boolean'){return true;}return false;},
  isnumber:function(v){if(typeof v==='number'){return true;}return false;},
  isstring:function(v){if(typeof v==='string'){return true;}return false;},
  isobject:function(v){if(typeof v==='object'){return true;}return false;},
  isfunction:function(v){if(typeof v==='function'){return true;}return false;},
  isempty:function(obj)
    {
    if(window.Object.getOwnPropertyNames(obj).length===0){return true;}
    return false;
    },
  isffx:function(){return (/firefox/i).test(window.navigator.userAgent);},
  copy:function(v){return v.slice(0);},
  clone:function(v){return Object.create({x:v.x,y:v.y,z:v.z});},
  sign:function(v)
    {
    v=parseFloat(Number(v).toFixed(1));
    if(v===0){return '&nbsp;';}
    if(v<0){return '';}
    if(v>0){return '+';}
    },
  random:function(n)
    {
    var i=0,type,start,len,rnd='';
    while(i<n)
      {
      type=Math.round(Math.random()*2);
      if(type===0)
        {
        start=48;
        len=10;
        }
      else
        {
        start=(Math.round(Math.random()*2)%2===0)?65:97;
        len=26;
        }
      rnd+=String.fromCharCode(start+Math.floor(Math.random()*len));
      i+=1;
      }
    return rnd;
    },
  interpolate:function(from,to,n,i){return from+(to-from)/n*i;},
  time:function(){return (new Date()).getTime();}
  };

lol.i=function(id){return window.document.getElementById(String(id));};
lol.el=function(el){return window.document.createElement(String(el));};
lol.tn=function(txt){return window.document.createTextNode(String(txt));};

function $r(parent,child) { (document.getElementById(parent)).removeChild(document.getElementById(child)); }
function $t(name) { return document.getElementsByTagName(name); }
function $c(code) { return String.fromCharCode(code); }
function $h(value) { return ('0'+Math.max(0,Math.min(255,Math.round(value))).toString(16)).slice(-2); }
function _i(id,value) { $t('div')[id].innerHTML+=value; }
function _h(value) { return !hires?value:Math.round(value/2); }

function get_screen_size()
  {
  var w=document.documentElement.clientWidth;
  var h=document.documentElement.clientHeight;
  return Array(w,h);
  };

lol.init=function()
  {
  //document.onkeypress=key_manager;
  //document.onkeyup=release;
  window.addEventListener('mousemove',lol.mouse.move,false);
  var evt=lol.util.isffx()?'DOMMouseScroll':'mousewheel';
  window.addEventListener(evt,lol.mouse.wheel,false);
  };

var url=document.location.href;

var flag=true;
var test=true;
var n=parseInt((url.indexOf('n=')!=-1)?url.substring(url.indexOf('n=')+2,((url.substring(url.indexOf('n=')+2,url.length)).indexOf('&')!=-1)?url.indexOf('n=')+2+(url.substring(url.indexOf('n=')+2,url.length)).indexOf('&'):url.length):512*4);
var w=0;
var h=0;
var x=0;
var y=0;
var z=0;
var star_color_ratio=0;
var star_x_save,star_y_save;
var star=new Array(n);
var color;
var opacity=0.1;

var hyperspace=0;

var canvas_x=0;
var canvas_y=0;
var canvas_w=0;
var canvas_h=0;
var context;

var key;
var ctrl;

var timeout;
var fps=0;

function init()
  {
  var a=0;
  for(var i=0;i<n;i++)
    {
    star[i]=new Array(5);
    star[i][0]=Math.random()*w*2-x*2;
    star[i][1]=Math.random()*h*2-y*2;
    star[i][2]=Math.round(Math.random()*z);
    star[i][3]=0;
    star[i][4]=0;
    }
  var starfield=lol.i('starfield');
  starfield.style.position='absolute';
  starfield.width=w;
  starfield.height=h;
  context=starfield.getContext('2d');
  //context.lineCap='round';
  context.fillStyle='rgb(0,0,0)';
  context.strokeStyle='rgb(255,255,255)';
  }

function anim()
  {
  if(hyperspace==1)
    {
    lol.spd=lol.spd*1.01;
    lol.zr=lol.zr*0.99;
    var c=Math.round(lol.spd*2.5)-2;
    context.fillStyle='rgb('+c+','+c+','+c+')';
    if(lol.spd>64)
      {
      context.fillStyle='rgb(0,0,0)';
      lol.spd=16;
      lol.zr=256;
      hyperspace=2;
      }
    }
  if(hyperspace==2)
    {
    if(lol.spd>1)
      {
      lol.spd*=0.995;
      }
    else
      {
      lol.spd=1;
      hyperspace=0;
      }
    }
  //context.fillRect(0,0,w,h);
  context.clearRect(0,0,w,h); /* clear viewport */
  for(var i=0;i<n;i++)
    {
    test=true;
    star_x_save=star[i][3];
    star_y_save=star[i][4];
    star[i][0]+=lol.mouse.p.x*0.1; if(star[i][0]>x<<1) { star[i][0]-=w<<1; test=false; } if(star[i][0]<-x<<1) { star[i][0]+=w<<1; test=false; }
    star[i][1]+=lol.mouse.p.y*0.1; if(star[i][1]>y<<1) { star[i][1]-=h<<1; test=false; } if(star[i][1]<-y<<1) { star[i][1]+=h<<1; test=false; }
    star[i][2]-=lol.spd; if(star[i][2]>z) { star[i][2]-=z; test=false; } if(star[i][2]<0) { star[i][2]+=z; test=false; }
    star[i][3]=x+(star[i][0]/star[i][2])*lol.zr;
    star[i][4]=y+(star[i][1]/star[i][2])*lol.zr;
    if(star_x_save>0&&star_x_save<w&&star_y_save>0&&star_y_save<h&&test)
      {
      context.lineWidth=(1-star_color_ratio*star[i][2])*2;
      context.beginPath();
      context.moveTo(star_x_save,star_y_save);
      context.lineTo(star[i][3],star[i][4]);
      context.stroke();
      context.closePath();
      }
    }
  timeout=setTimeout('anim()',fps);
  }

function key_manager(evt)
  {
  evt=evt||event;
  key=evt.which||evt.keyCode;
  //ctrl=evt.ctrlKey;
  switch(key)
    {
    case 27:
      flag=flag?false:true;
      if(flag)
        {
        timeout=setTimeout('anim()',fps);
        }
      else
        {
        clearTimeout(timeout);
        }
      break;
    case 32:
      hyperspace=1;
      break;
    case 13:
      context.fillStyle='rgba(0,0,0,'+opacity+')';
      break;
    }
  top.status='key='+((key<100)?'0':'')+((key<10)?'0':'')+key;
  }

function release()
  {
  switch(key)
    {
    case 13:
      context.fillStyle='rgb(0,0,0)';
      break;
    }
  }

lol.mouse=
  {
  p:{x:0,y:0}, /* position */
  o:{x:0,y:0}, /* origin */
  click:false,
  move:function(e)
    {
    e=e||window.event;
    lol.mouse.p.x=((e.pageX-lol.mouse.o.x)/window.innerWidth)*128;
    lol.mouse.p.y=((e.pageY-lol.mouse.o.y)/window.innerHeight)*128;
    e.preventDefault();
    },
  wheel:function(e)
    {
    e=e||window.event;
    var delta=e.wheelDelta/120;
    lol.spd-=delta*0.1;
    e.preventDefault();
    }
  };

function start()
  {
  resize();
  anim();
  }

function resize()
  {
  w=parseInt((url.indexOf('w=')!=-1)?url.substring(url.indexOf('w=')+2,((url.substring(url.indexOf('w=')+2,url.length)).indexOf('&')!=-1)?url.indexOf('w=')+2+(url.substring(url.indexOf('w=')+2,url.length)).indexOf('&'):url.length):get_screen_size()[0]);
  h=parseInt((url.indexOf('h=')!=-1)?url.substring(url.indexOf('h=')+2,((url.substring(url.indexOf('h=')+2,url.length)).indexOf('&')!=-1)?url.indexOf('h=')+2+(url.substring(url.indexOf('h=')+2,url.length)).indexOf('&'):url.length):get_screen_size()[1]);
  x=Math.round(w/2);
  y=Math.round(h/2);
  z=(w+h)/2;
  star_color_ratio=1/z;
  lol.mouse.o={x:x,y:y};
  init();
  }

lol.init();
</script>
</head>
<body onload="start()" onresize="resize()" onmousedown="context.fillStyle='rgba(0,0,0,'+opacity+')'" onmouseup="context.fillStyle='rgb(0,0,0)'">
<canvas id="starfield" style="background-color:#000000"></canvas>
</body>

</html>
