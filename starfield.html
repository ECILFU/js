<!doctype html>
<html lang="en">

<head>
<title>starfield</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<meta http-equiv="content-language" content="en">
<meta name="description" content="starfield">
<meta name="author" content="rez">
<meta name="version" content="3.0">
<meta name="copyright" content="rez 2007-2015">
<meta name="robots" content="all">
<style type="text/css">
body {margin:0px;padding:0px;overflow:hidden;user-select:none}
</style>
<script type="application/javascript">
/*-----------------------------------------------------------------------------.
|                 /\______  /\______  ____/\______     __                      |
|                 \____   \/  \__   \/  _ \____   \ __/  \____                 |
|                  / _/  _/    \/   /   /  / _/  _// / / / / /                 |
|                 /  \   \  /\ /   /\  /  /  \   \/ /\  / / /                  |
|                 \__/\   \/RTX______\___/\__/\   \/ / /_/_/                   |
|                      \___)   \__)            \___) \/                        |
|------------------------------------------------------------------------------|
|################################## STARFIELD #################################|
`-----------------------------------------------------------------------------*/

/*jslint white,this,maxlen:80*/
/*global window,jslint*/

Number.prototype.clamp=function(min,max)
  {
  'use strict';
  return Math.max(min,Math.min(this,max));
  };

var url=document.location.href;

var flag=true;
var test=true;
var n=parseInt((url.indexOf('n=')!=-1)?url.substring(url.indexOf('n=')+2,((url.substring(url.indexOf('n=')+2,url.length)).indexOf('&')!=-1)?url.indexOf('n=')+2+(url.substring(url.indexOf('n=')+2,url.length)).indexOf('&'):url.length):512*4);
var w=0;
var h=0;
var x=0;
var y=0;
var z=0;
var star_color_ratio=0;
var star=new Array(n);
var color;

var hyperspace=0;

var timeout;
var fps=40;

var lol={}

lol.id='starfield';
lol.pr={w:1,h:1};     /* pixel ratio */
lol.zr=256;           /* perspective */
lol.timer=0;
lol.spd=1.0;          /* speed */
lol.rid=false;        /* frame request id */
lol.cvs=false;        /* canvas */
lol.ctx=false;        /* 2d lol.ctx */

lol.util=
  {
  isboolean:function(v){if(typeof v==='boolean'){return true;}return false;},
  isnumber:function(v){if(typeof v==='number'){return true;}return false;},
  isstring:function(v){if(typeof v==='string'){return true;}return false;},
  isobject:function(v){if(typeof v==='object'){return true;}return false;},
  isfunction:function(v){if(typeof v==='function'){return true;}return false;},
  isempty:function(obj)
    {
    if(window.Object.getOwnPropertyNames(obj).length===0){return true;}
    return false;
    },
  isffx:function(){return (/firefox/i).test(window.navigator.userAgent);},
  copy:function(v){return v.slice(0);},
  clone:function(v){return Object.create({x:v.x,y:v.y,z:v.z});},
  sign:function(v)
    {
    v=parseFloat(Number(v).toFixed(1));
    if(v===0){return '&nbsp;';}
    if(v<0){return '';}
    if(v>0){return '+';}
    },
  random:function(n)
    {
    var i=0,type,start,len,rnd='';
    while(i<n)
      {
      type=Math.round(Math.random()*2);
      if(type===0)
        {
        start=48;
        len=10;
        }
      else
        {
        start=(Math.round(Math.random()*2)%2===0)?65:97;
        len=26;
        }
      rnd+=String.fromCharCode(start+Math.floor(Math.random()*len));
      i+=1;
      }
    return rnd;
    },
  interpolate:function(from,to,n,i){return from+(to-from)/n*i;},
  time:function(){return (new Date()).getTime();}
  };

lol.i=function(id){return window.document.getElementById(String(id));};
lol.el=function(el){return window.document.createElement(String(el));};
lol.tn=function(txt){return window.document.createTextNode(String(txt));};

function $r(parent,child) { (document.getElementById(parent)).removeChild(document.getElementById(child)); }
function $t(name) { return document.getElementsByTagName(name); }
function $c(code) { return String.fromCharCode(code); }
function $h(value) { return ('0'+Math.max(0,Math.min(255,Math.round(value))).toString(16)).slice(-2); }
function _i(id,value) { $t('div')[id].innerHTML+=value; }
function _h(value) { return !hires?value:Math.round(value/2); }

function get_screen_size()
  {
  var w=document.documentElement.clientWidth;
  var h=document.documentElement.clientHeight;
  return Array(w,h);
  };

lol.init=function()
  {
  //document.onkeypress=key_manager;
  //document.onkeyup=release;
  window.addEventListener('resize',lol.resize,false);
  window.addEventListener('mousemove',lol.mouse.move,false);
  var evt=lol.util.isffx()?'DOMMouseScroll':'mousewheel';
  window.addEventListener(evt,lol.mouse.wheel,false);
  for(var i=0;i<n;i++)
    {
    star[i]=new Array(5);
    star[i][0]=Math.random()*w*2-x*2;
    star[i][1]=Math.random()*h*2-y*2;
    star[i][2]=Math.round(Math.random()*z);
    star[i][3]=0;
    star[i][4]=0;
    }
  lol.viewport();
  lol.resize();
  lol.anim.start();
  };

lol.viewport=function()
  {
  var w=window.innerWidth,h=window.innerHeight,el=lol.el('div');
  lol.w=(w+lol.pr.w-w%lol.pr.w)/lol.pr.w;lol.w+=lol.w%2;
  lol.h=(h+lol.pr.h-h%lol.pr.h)/lol.pr.h;lol.h+=lol.h%2;
  el.id=lol.id;
  el.width=lol.w*lol.pr.w;
  el.height=lol.h*lol.pr.h;
  el.style.position='absolute';
  window.document.body.appendChild(el);
  lol.cvs=lol.el('canvas');
  lol.cvs.id=lol.id+'-viewport';
  lol.cvs.style.position='absolute';
  el.appendChild(lol.cvs);
  lol.ctx=lol.cvs.getContext('2d');
  };

lol.resize=function()
  {
  w=window.innerWidth;
  h=window.innerHeight;
  x=Math.round(w/2);
  y=Math.round(h/2);
  z=(w+h)/2;
  star_color_ratio=1/z;
  lol.mouse.o={x:x,y:y};
  //var w=window.innerWidth,h=window.innerHeight,el=lol.i(lol.id);
  var el=lol.i(lol.id);
  lol.w=(w+lol.pr.w-w%lol.pr.w)/lol.pr.w;lol.w+=lol.w%2;
  lol.h=(h+lol.pr.h-h%lol.pr.h)/lol.pr.h;lol.h+=lol.h%2;
  el.width=lol.w*lol.pr.w;
  el.height=lol.h*lol.pr.h;
  lol.cvs.width=lol.w*lol.pr.w;
  lol.cvs.height=lol.h*lol.pr.h;
  lol.cvs.style.backgroundColor='#000';
  lol.ctx.scale(lol.pr.w,lol.pr.h);
  //lol.anim.update();
  };

lol.anim=
  {
  update:function()
    {
    if(hyperspace===1)
      {
      lol.spd=lol.spd*1.01;
      lol.zr=lol.zr*0.99;
      var c=Math.round(lol.spd*2.5)-2;
      lol.ctx.fillStyle='rgb('+c+','+c+','+c+')';
      if(lol.spd>64)
        {
        lol.ctx.fillStyle='rgb(0,0,0)';
        lol.spd=16;
        lol.zr=256;
        hyperspace=2;
        }
      }
    if(hyperspace===2)
      {
      if(lol.spd>1)
        {
        lol.spd*=0.995;
        }
      else
        {
        lol.spd=1;
        hyperspace=0;
        }
      }
    //lol.ctx.fillRect(0,0,w,h);
    lol.ctx.clearRect(0,0,w,h); /* clear viewport */
    for(var i=0;i<n;i++)
      {
      var test=true,x2=star[i][3],y2=star[i][4];
      star[i][0]+=lol.mouse.p.x*0.1; if(star[i][0]>x<<1) { star[i][0]-=w<<1; test=false; } if(star[i][0]<-x<<1) { star[i][0]+=w<<1; test=false; }
      star[i][1]+=lol.mouse.p.y*0.1; if(star[i][1]>y<<1) { star[i][1]-=h<<1; test=false; } if(star[i][1]<-y<<1) { star[i][1]+=h<<1; test=false; }
      star[i][2]-=lol.spd; if(star[i][2]>z) { star[i][2]-=z; test=false; } if(star[i][2]<0) { star[i][2]+=z; test=false; }
      star[i][3]=x+(star[i][0]/star[i][2])*lol.zr;
      star[i][4]=y+(star[i][1]/star[i][2])*lol.zr;
      if(x2>0&&x2<w&&y2>0&&y2<h&&test)
        {
        lol.ctx.lineWidth=(1-star_color_ratio*star[i][2])*2;
        lol.ctx.beginPath();
        lol.ctx.moveTo(x2,y2);
        lol.ctx.lineTo(star[i][3],star[i][4]);
        lol.ctx.stroke();
        lol.ctx.closePath();
        }
      }
    timeout=setTimeout('lol.anim.update()',fps);
    },
  start:function()
    {
    timeout=setTimeout('lol.anim.update()',fps);
    },
  stop:function()
    {
    clearTimeout(timeout);
    }
  };

function key_manager(evt)
  {
  evt=evt||event;
  var key=evt.which||evt.keyCode;
  switch(key)
    {
    case 27:
      flag=!flag;
      if(flag)
        {
        timeout=setTimeout('anim()',fps);
        }
      else
        {
        clearTimeout(timeout);
        }
      break;
    case 32:
      hyperspace=1;
      break;
    case 13:
      break;
    }
  }

lol.mouse=
  {
  p:{x:0,y:0}, /* position */
  o:{x:0,y:0}, /* origin */
  click:false,
  move:function(e)
    {
    e=e||window.event;
    lol.mouse.p.x=((e.pageX-lol.mouse.o.x)/window.innerWidth)*128;
    lol.mouse.p.y=((e.pageY-lol.mouse.o.y)/window.innerHeight)*128;
    e.preventDefault();
    },
  wheel:function(e)
    {
    e=e||window.event;
    var delta=e.wheelDelta/120;
    lol.spd-=delta*0.1;
    e.preventDefault();
    }
  };
</script>
</head>
<body onload="lol.init()"></body>

</html>
